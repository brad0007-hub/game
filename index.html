<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo RPS Challenge (Deployable)</title>
    
    <!-- CRITICAL DEPLOYMENT STEP: Styles are internalized. -->
    <style>
        /*
        Internalized CSS: A comprehensive set of Tailwind utility classes used in the HTML.
        */
        .bg-background { background-color: #f3f4f6; }
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .font-sans { font-family: 'Inter', sans-serif; }
        .p-4 { padding: 1rem; }
        .w-full { width: 100%; }
        .max-w-lg { max-width: 32rem; }
        .max-w-md { max-width: 28rem; }
        .bg-card { background-color: #ffffff; }
        .rounded-xl { border-radius: 0.75rem; }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .p-6 { padding: 1.5rem; }
        .md\:p-8 { padding: 2rem; }
        .border { border-width: 1px; }
        .border-gray-100 { border-color: #f3f4f6; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .md\:text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .font-bold { font-weight: 700; }
        .text-center { text-align: center; }
        .text-gray-800 { color: #1f2937; }
        .mb-6 { margin-bottom: 1.5rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-gray-500 { color: #6b7280; }
        .mb-4 { margin-bottom: 1rem; }
        .flex-col { flex-direction: column; }
        .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.5rem; }
        .bg-gray-50 { background-color: #f9fafb; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); }
        .border-gray-200 { border-color: #e5e7eb; }
        .font-semibold { font-weight: 600; }
        .text-primary { color: #059669; } /* Emerald Green */
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .min-h-\[6rem\] { min-height: 6rem; }
        .border-2 { border-width: 2px; }
        .border-dashed { border-style: dashed; }
        .border-gray-300 { border-color: #d1d5db; }
        .grid { display: grid; }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-amber-500 { background-color: #f59e0b; }
        .text-white { color: #fff; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .hover\:bg-emerald-700:hover { background-color: #047857; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-amber-600:hover { background-color: #d97706; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:ring-4:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow); }
        .text-red-500 { color: #ef4444; }
        .font-extrabold { font-weight: 800; }
        .uppercase { text-transform: uppercase; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .mt-2 { margin-top: 0.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .border-red-500 { border-color: #ef4444; }
        .border-blue-500 { border-color: #3b82f6; }
        .bg-red-500 { background-color: #ef4444; }
        .hover\:bg-red-600:hover { background-color: #dc2626; }
        .bg-gray-300 { background-color: #d1d5db; }
        .hover\:bg-gray-400:hover { background-color: #9ca3af; }
        .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .hidden { display: none; }
        .w-full { width: 100%; }
        .bg-green-500 { background-color: #10b981; }
        .hover\:bg-green-600:hover { background-color: #059669; }
        .game-button {
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
            cursor: pointer;
        }
        .game-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .game-button:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .game-button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        #start-new-game-btn:disabled {
             opacity: 1; /* Keep visible */
        }
    </style>
</head>
<body class="bg-background min-h-screen flex items-center justify-center font-sans p-4">

    <script type="module">
        // ----------------------------------------------------------------------
        // 1. POKI SDK PLACEHOLDER (CRITICAL FOR DEPLOYMENT)
        // ----------------------------------------------------------------------
        const PokiSDK = {
            init: (callback) => { 
                console.log("PokiSDK initialized."); 
                setTimeout(callback, 50); 
            },
            gameplayStart: () => { console.log("Poki: Gameplay Started."); },
            gameplayStop: () => { console.log("Poki: Gameplay Stopped."); },
            commercialBreak: (callback) => { 
                console.log("Poki: Starting Commercial Break (Ad)."); 
                setTimeout(callback, 500); 
            },
        }; 
        // ----------------------------------------------------------------------

        // ----------------------------------------------------------------------
        // 2. SOLO GAME STATE AND CONFIG
        // ----------------------------------------------------------------------
        window.WIN_SCORE = 5;
        window.ROUND_DURATION = 5; // seconds
        const choices = ['rock', 'paper', 'scissors'];
        
        // Game State
        window.soloPlayerScore = 0;
        window.soloComputerScore = 0;
        window.soloGameTimer = null;
        window.soloRound = 0;
        window.GAME_ACTIVE = false;

        // DOM Elements
        const resultDisplayEl = document.getElementById('result-display');
        const gameTitleEl = document.getElementById('game-title');
        const startBtn = document.getElementById('start-new-game-btn');
        const gameButtons = document.querySelectorAll('.game-button');
        
        window.getEmoji = function(choice) {
            switch (choice) {
                case 'rock': return 'ü™® Rock';
                case 'paper': return 'üìÑ Paper';
                case 'scissors': return '‚úÇÔ∏è Scissors';
                default: return '';
            }
        };

        window.toggleButtons = function(disabled) {
            gameButtons.forEach(button => {
                button.disabled = disabled;
            });
        };

        // --- CORE SOLO GAME LOGIC ---

        window.showLobbyScreen = function() {
            // POKI HOOK: Gameplay Stop
            PokiSDK.gameplayStop();

            if (soloGameTimer) clearInterval(soloGameTimer);
            GAME_ACTIVE = false;

            gameTitleEl.textContent = 'Solo RPS Challenge';
            startBtn.classList.remove('hidden');
            toggleButtons(true);
            
            resultDisplayEl.innerHTML = `
                <p class="text-2xl font-bold text-gray-700">First to ${WIN_SCORE} wins!</p>
                <p class="text-lg font-medium text-gray-500 mt-2">Click Start to begin.</p>
            `;
            resultDisplayEl.className = 'min-h-[6rem] mb-6 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center flex flex-col justify-center items-center';
        };

        window.startNewGame = function() {
            // POKI HOOK: Gameplay Start
            PokiSDK.gameplayStart();

            if (soloGameTimer) clearInterval(soloGameTimer);
            soloPlayerScore = 0;
            soloComputerScore = 0;
            soloRound = 1;
            GAME_ACTIVE = true;
            startBtn.classList.add('hidden');
            
            soloUpdateUI(null, null, 'start');
            soloStartRoundTimer();
        };

        window.getComputerChoice = function() {
            const randomIndex = Math.floor(Math.random() * choices.length);
            return choices[randomIndex];
        }

        window.determineRoundWinnerSolo = function(playerChoice, computerChoice) {
            if (playerChoice === computerChoice) return 'draw';
            if (
                (playerChoice === 'rock' && computerChoice === 'scissors') ||
                (playerChoice === 'paper' && computerChoice === 'rock') ||
                (playerChoice === 'scissors' && computerChoice === 'paper')
            ) {
                return 'win';
            }
            return 'lose';
        };

        window.soloUpdateUI = function(playerChoice, computerChoice, result) {
            document.getElementById('solo-player-score').textContent = soloPlayerScore;
            document.getElementById('solo-computer-score').textContent = soloComputerScore;

            let message = '';
            let color = 'border-gray-300';

            if (result === 'start') {
                message = `<p class="text-lg font-medium text-gray-700">Round ${soloRound}. First to ${WIN_SCORE} wins!</p>`;
            } else if (result === 'win') {
                soloPlayerScore++;
                message = `<p class="text-3xl font-bold text-primary animate-pulse">YOU WIN! üéâ</p><p class="mt-2 text-lg text-gray-600">${getEmoji(playerChoice)} beats ${getEmoji(computerChoice)}.</p>`;
                color = 'border-primary';
            } else if (result === 'lose') {
                soloComputerScore++;
                message = `<p class="text-3xl font-bold text-red-500 animate-pulse">YOU LOSE! üò≠</p><p class="mt-2 text-lg text-gray-600">${getEmoji(computerChoice)} beats ${getEmoji(playerChoice)}.</p>`;
                color = 'border-red-500';
            } else if (result === 'draw') {
                message = `<p class="text-3xl font-bold text-blue-500">IT'S A TIE! ü§ù</p><p class="mt-2 text-lg text-gray-600">Both chose ${getEmoji(playerChoice)}.</p>`;
                color = 'border-blue-500';
            } else if (result === 'timeout') {
                 soloComputerScore++;
                 message = `<p class="text-3xl font-bold text-red-600">TIME OUT! ‚è±Ô∏è</p><p class="mt-2 text-lg text-gray-600">You forfeit the round. Computer scores.</p>`;
                 color = 'border-red-600';
            }

            if (soloPlayerScore >= WIN_SCORE || soloComputerScore >= WIN_SCORE) {
                soloHandleGameOver(soloPlayerScore > soloComputerScore);
                return;
            }

            resultDisplayEl.innerHTML = message;
            resultDisplayEl.className = `min-h-[6rem] mb-6 p-4 border-2 border-dashed rounded-lg text-center flex flex-col justify-center items-center ${color}`;
            
            if (result !== 'start') {
                document.getElementById('solo-player-score').textContent = soloPlayerScore;
                document.getElementById('solo-computer-score').textContent = soloComputerScore;
                soloRound++;
                setTimeout(soloStartRoundTimer, 2000);
            }
        };

        window.soloStartRoundTimer = function() {
            if (soloGameTimer) clearInterval(soloGameTimer);
            let countdown = ROUND_DURATION;
            toggleButtons(false);

            resultDisplayEl.innerHTML = `<p class="text-lg font-medium text-gray-700">Round ${soloRound}: Make your move!</p>
                                         <p class="text-2xl font-bold text-gray-800 mt-2">Time Left: <span id="solo-countdown" class="text-red-500 text-4xl font-extrabold">${countdown}</span></p>`;
            resultDisplayEl.className = 'min-h-[6rem] mb-6 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center flex flex-col justify-center items-center';
            
            const countdownEl = document.getElementById('solo-countdown');
            toggleButtons(false);

            soloGameTimer = setInterval(() => {
                countdown--;
                if (countdownEl) countdownEl.textContent = countdown;
                toggleButtons(false); // Ensure buttons remain enabled during countdown

                if (countdown <= 0) {
                    clearInterval(soloGameTimer);
                    soloUpdateUI('none', getComputerChoice(), 'timeout');
                }
            }, 1000);
            toggleButtons(false); // Enable buttons when timer starts
        };

        window.soloPlayRound = function(playerChoice) {
            if (soloGameTimer) clearInterval(soloGameTimer);
            toggleButtons(true);
            
            const computerChoice = getComputerChoice();
            const winner = determineRoundWinnerSolo(playerChoice, computerChoice);
            
            soloUpdateUI(playerChoice, computerChoice, winner);
        };

        window.soloHandleGameOver = function(playerWon) {
            if (soloGameTimer) clearInterval(soloGameTimer);
            
            // POKI HOOK: Stop Gameplay & Initiate Commercial Break
            PokiSDK.gameplayStop();
            PokiSDK.commercialBreak(() => {
                const winnerText = playerWon ? 
                    `<p class="text-4xl font-extrabold text-primary">GAME OVER! üèÜ</p><p class="text-2xl font-bold text-gray-700 mt-2">You are the Champion!</p>` : 
                    `<p class="text-4xl font-extrabold text-red-500">GAME OVER! üò≠</p><p class="text-2xl font-bold text-gray-700 mt-2">The Computer won this time.</p>`;

                resultDisplayEl.innerHTML = winnerText;
                resultDisplayEl.className = `min-h-[6rem] mb-6 p-4 border-2 border-dashed ${playerWon ? 'border-primary' : 'border-red-500'} rounded-lg text-center flex flex-col justify-center items-center`;
                
                // Show start button and wait for user input to play again
                startBtn.classList.remove('hidden');
                toggleButtons(true);
                GAME_ACTIVE = false;
            });
        };
        
        // Main function called on button click
        window.playGame = function(playerChoice) {
            if (GAME_ACTIVE) {
                soloPlayRound(playerChoice);
            }
        };

        // Initial Load: Initialize PokiSDK FIRST, then set up the lobby screen
        window.addEventListener('load', () => {
            PokiSDK.init(() => {
                showLobbyScreen();
            });
        });

    </script>

    <!-- Main Game Container (Always visible now) -->
    <div id="game-container" class="w-full max-w-lg bg-card rounded-xl shadow-2xl p-6 md:p-8 border border-gray-100">
        <h1 id="game-title" class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6 flex items-center justify-center">
            ü§ñ Solo RPS Challenge ü§ñ
        </h1>
        
        <!-- Scoreboard (1v1) -->
        <div id="solo-scoreboard" class="flex justify-around items-center bg-gray-50 p-4 rounded-lg mb-6 shadow-inner border border-gray-200">
            <div class="text-center">
                <p class="text-sm font-semibold uppercase text-gray-500">You</p>
                <p id="solo-player-score" class="text-4xl font-extrabold text-primary">0</p>
            </div>
            <div class="text-center">
                <p class="text-sm font-semibold uppercase text-gray-500">Computer</p>
                <p id="solo-computer-score" class="text-4xl font-extrabold text-red-500">0</p>
            </div>
        </div>
        
        <!-- Result/Timer Display -->
        <div id="result-display" class="min-h-[6rem] mb-6 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center flex flex-col justify-center items-center">
            <p class="text-lg font-medium text-gray-700">Ready to play?</p>
        </div>

        <!-- Game Buttons -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <button onclick="playGame('rock')" class="game-button bg-primary text-white p-4 rounded-xl text-3xl font-bold shadow-lg hover:bg-emerald-700 focus:outline-none focus:ring-4 focus:ring-primary/50" disabled>
                ü™®
            </button>
            <button onclick="playGame('paper')" class="game-button bg-blue-500 text-white p-4 rounded-xl text-3xl font-bold shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-500/50" disabled>
                üìÑ
            </button>
            <button onclick="playGame('scissors')" class="game-button bg-amber-500 text-white p-4 rounded-xl text-3xl font-bold shadow-lg hover:bg-amber-600 focus:outline-none focus:ring-4 focus:ring-amber-500/50" disabled>
                ‚úÇÔ∏è
            </button>
        </div>

        <!-- Start Button -->
        <button id="start-new-game-btn" onclick="startNewGame()" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition duration-150 focus:outline-none focus:ring-4 focus:ring-green-500/50">
            Start New Game
        </button>
    </div>

</body>
</html>
